# 数据库结构优化

## 1 数据库结构优化介绍

优化目的：
【1】减少数据冗余
【2】尽量避免数据维护中出现更新 、插入和删除异常
     插入异常：如果表中的某个实体随着另外一个实体而存在
     更新异常：如果更改表中的某个实体的单独属性时，需要对多行进行更新
     删除异常：如果删除表中的某一实体则会导致其他实体的消失  
【3】节约数据存储空间
【4】提高查询效率

## 2 数据库机构设计的步骤

【1】需求分析： 
    存储要求
    数据处理需求
    数据的安全性和完整性
【2】 逻辑设计：
    设计数据的逻辑存储结构
    数据实体之间的逻辑关系，解决数据冗余和数据维护异常
【3】物理设计：
    关系型数据库
    非关系型数据库   
【4】 维护优化：
    根据实际情况对索引、存储结构等进行优化
       
 ## 3 数据库设计范式 （视频4-2）
 
 【1】第一范式  
      数据库表中的所有字段都只具有单一属性
      单一属性的列是由基本的数据类型所构成的
      设计出来的表都是简单的二维表
 【2】第二范式  
        符合第一范式
        要求一个表中只有一个业务主键
        
 【3】第三范式       
        符合第二范式
        指每一个非主属性既不部分依赖于也不传递依赖于业务主键

 ## 4  数据类型选择

【1】 当一个列可以选择多个数据类型时优先选择数字类型，其次是日期或二进制类型，最后是字符类型
【2】整数类型
tinyint    存储空间：1字节   取值范围   （unsigned） 0-255
smallint   存储空间：2字节   取值范围   （unsigned） 0-65535
mediumint  存储空间：3字节   取值范围   （unsigned） 0-16777215
int        存储空间：4字节   取值范围   （unsigned） 0-429497295
bigint     存储空间：8字节   取值范围   （unsigned）  
【3】实数类型

float       4个字节                                是否为精准类型（否）
double      8个字节                                是否为精准类型（否）
decimal     每4个字节存9个数字，小数点占一个字节   是否为精准类型（是）

财务数据需要使用 decimal 类型

【4】varchar  与 char （计算长度都是用 字符不用字节）
特别长的用text存储

varchar特点：
varchar 用于存储变长字符串，只占用必要的存储空间

列的最大长度小于255 则只占用一个额外字节用于记录字符串长度
列的最大长度大于255 则只占用两个额外字节用于记录字符串长度

char特点：

char类型时定长的
字符串存储在CHAR类型的列中会删除末尾的空格
char类型的最大宽度为255

适合 固定长度的值（列如：身份证   密码  id 等）
存储短字符串

【5】dateTime 与 timestamp

dateTIme 类型  以YYYY-MM-DD  HH:MM:SS 格式存储
dateTIme类型与时区无关，只占8个字节的存储空间 时间范围 1000-01-01 00:00:00 到9999-12-31 23:59:59

timestamp 存储格林尼治时间1970 年1月1日 到当前时间的秒数 以YYYY-MM-DD  HH:MM:SS 的格式显示 占4个字节（以int存储）
时间范围 1970-01-01  到  2038-01-19
timestamp 类型显示依赖于所指定的时区
 
【6】date 与 time （mysql 5.7 及以后）

date 类型只需要3个字节
date 类型可以利用日期时间函数进行日志的计算
存储范围： 1000-01-01  到9999-12-31 

time 类型 （存储 时分秒）


## 5 MySQL数据类型
在 MySQL 中，有三种主要的类型：文本、数字和日期/时间类型。

Text 类型：
数据类型	描述
CHAR(size)	保存固定长度的字符串（可包含字母、数字以及特殊字符）。在括号中指定字符串的长度。最多 255 个字符。
VARCHAR(size)	非空VARCHAR的最大总长度是65533【字节】
保存可变长度的字符串（可包含字母、数字以及特殊字符）。

注释：如果值的长度大于 255，则被转换为 TEXT 类型。

    TINYTEXT	存放最大长度为 255 个字符的字符串。
    TEXT	存放最大长度为 65,535 个字符的字符串。
    BLOB	用于 BLOBs (Binary Large OBjects)。存放最多 65,535 字节的数据。
    MEDIUMTEXT	存放最大长度为 16,777,215 个字符的字符串。
    MEDIUMBLOB	用于 BLOBs (Binary Large OBjects)。存放最多 16,777,215 字节的数据。
    LONGTEXT	存放最大长度为 4,294,967,295 个字符的字符串。
    LONGBLOB	用于 BLOBs (Binary Large OBjects)。存放最多 4,294,967,295 字节的数据。
    ENUM(x,y,z,etc.)	
    允许你输入可能值的列表。可以在 ENUM 列表中列出最大 65535 个值。如果列表中不存在插入的值，则插入空值。
    注释：这些值是按照你输入的顺序存储的。 可以按照此格式输入可能的值：ENUM('X','Y','Z')
    
    SET	与 ENUM 类似，SET 最多只能包含 64 个列表项，不过 SET 可存储一个以上的值。

Number 类型：

    数据类型	描述
    TINYINT(size)	-128 到 127 常规。0 到 255 无符号*。在括号中规定最大位数。
    SMALLINT(size)	-32768 到 32767 常规。0 到 65535 无符号*。在括号中规定最大位数。
    MEDIUMINT(size)	-8388608 到 8388607 普通。0 to 16777215 无符号*。在括号中规定最大位数。
    INT(size)	-2147483648 到 2147483647 常规。0 到 4294967295 无符号*。在括号中规定最大位数。
    BIGINT(size)	-9223372036854775808 到 9223372036854775807 常规。0 到 18446744073709551615 无符号*。在括号中规定最大位数。
    FLOAT(size,d)	带有浮动小数点的小数字。在括号中规定最大位数。在 d 参数中规定小数点右侧的最大位数。
    DOUBLE(size,d)	带有浮动小数点的大数字。在括号中规定最大位数。在 d 参数中规定小数点右侧的最大位数。
    DECIMAL(size,d)	作为字符串存储的 DOUBLE 类型，允许固定的小数点。
    * 这些整数类型拥有额外的选项 UNSIGNED。通常，整数可以是负数或正数。如果添加 UNSIGNED 属性，那么范围将从 0 开始，而不是某个负数。

Date 类型：

    数据类型	描述
    DATE()	  日期。格式：YYYY-MM-DD    注释：支持的范围是从 '1000-01-01' 到 '9999-12-31'
    DATETIME()	  *日期和时间的组合。格式：YYYY-MM-DD HH:MM:SS  注释：支持的范围是从 '1000-01-01 00:00:00' 到 '9999-12-31 23:59:59'
    TIMESTAMP()	   *时间戳。TIMESTAMP 值使用 Unix 纪元('1970-01-01 00:00:00' UTC) 至今的描述来存储。格式：YYYY-MM-DD HH:MM:SS 注释：支持的范围是从 '1970-01-01 00:00:01' UTC 到 '2038-01-09 03:14:07' UTC
    TIME()	时间。格式：HH:MM:SS 注释：支持的范围是从 '-838:59:59' 到 '838:59:59'
    YEAR()	  2 位或 4 位格式的年。  注释：4 位格式所允许的值：1901 到 2155。2 位格式所允许的值：70 到 69，表示从 1970 到 2069。
    
    * 即便 DATETIME 和 TIMESTAMP 返回相同的格式，它们的工作方式很不同。在 INSERT 或 UPDATE 查询中，TIMESTAMP 自动把自身设置为当前的日期和时间。TIMESTAMP 也接受不同的格式，比如 YYYYMMDDHHMMSS、YYMMDDHHMMSS、YYYYMMDD 或 YYMMDD。
 







数据库设置字段长度是当前字符集的字符长度，而不是字节长度


int  
int支持的数字范围为：10位，有符号范围：-2147483648 到 2147483647   无符号范围：0-4294967295
bigint  
bigint支持的数字的大小范围为：20位，存电话号码。有符号范围：-9223372036854775808 到 9223372036854775807
decimal  金融格式  
decimal(m,d) 参数m<65 是总个数，d<30且 d<m 是小数位
dateTIme  最大支持微秒（ dateTIme(6) ）       YYYY-MM-DD  HH:MM:SS
timestamp      最大支持微秒（ dateTIme(6) ）   YYYY-MM-DD  HH:MM:SS
date YYYY-MM-DD
time   最大支持微秒（ time(6) ）  时间 HH:MM:SS 
char 固定长度  最大255字符 
varchar  可变长度   最大65533 字节  大约64k
text   可变长度 最大65533 字符   大约64k
mediumtext  可变长度 中等文本   最大16777215 字符  字节 约16M
longtext   可变长度  长文本    最大 4,294,967,295 字符   约4G

BLOB    用于 BLOBs (二进制大对象)。存放最多 65,535 字节的数据。
LONGBLOB    用于 BLOBs (二进制大对象)。存放最多 4,294,967,295 字节的数据。

非空CHAR的最大总长度是255【字节】；非空VARCHAR的最大总长度是65533【字节】


datetime 最大为 9999-12-30 23:59:59  long值   2534 0218 5599
2534 0218 5599 000 000  	微秒18位
2534 0218 5599 000  		毫秒15位
2534 0218 5599   			秒12位


char(30)占用90个字节，编码是utf8
char(30)占用120个字节，编码是utf8mb4

字符类型若为gbk，每个字符最多占2个字节，最大长度不能超过32766;
字符类型若为utf8，每个字符最多占3个字节，最大长度不能超过21845。
字符类型若为utf8mb4，每个字符最多占3个字节，最大长度不能超过16383。
若定义的时候超过上述限制，则varchar字段会被强行转为text类型，并产生warning。

行长度限制
导致实际应用中varchar长度限制的是一个行定义的长度。 MySQL要求一个行的定义长度不能超过65535。若定义的表长度超过这个值，则提示
ERROR 1118 (42000): Row size too large. The maximum row size for the used table type, not counting BLOBs, is 65535. You have to change some columns to TEXT or BLOBs。







